#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

npm run lint
LINT_STATUS=$?
npx prettier --check .
PRETTIER_STATUS=$?

if [ $LINT_STATUS -ne 0 ] || [ $PRETTIER_STATUS -ne 0 ]; then
  echo "Lint or Prettier failed. Attempting to fix with ESLint and Prettier..."
  npm run lint -- --fix
  npm run prettier -- --write
  npm run lint
  LINT_STATUS=$?
  npx prettier --check .
  PRETTIER_STATUS=$?
  if [ $LINT_STATUS -ne 0 ] || [ $PRETTIER_STATUS -ne 0 ]; then
    echo "Lint or Prettier still failing after auto-fix. Aborting push."
    exit 1
  fi
fi

npm run build
if [ $? -ne 0 ]; then
  echo "Build failed. Aborting push."
  exit 1
fi 